

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Stories - The Training Data &mdash; Rasa Core 0.8.2 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="_static/banner.css" type="text/css" />
  
    <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="Rasa Core 0.8.2 documentation" href="index.html"/>
        <link rel="next" title="Common Patterns" href="patterns.html"/>
        <link rel="prev" title="Domain, Slots, and Actions" href="domains.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Rasa Core
          

          
          </a>

          
            
            
              <div class="version">
                0.8
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="motivation.html">Motivation</a></li>
<li class="toctree-l1"><a class="reference internal" href="no_python.html">But I don&#8217;t code in python!</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="tutorial_basics.html">Building a Simple Bot</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial_supervised.html">Supervised Learning Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial_interactive_learning.html">Interactive Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial_remote.html">Rasa Core without Python</a></li>
</ul>
<p class="caption"><span class="caption-text">Deep Dives</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="domains.html">Domain, Slots, and Actions</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Stories - The Training Data</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#format">Format</a></li>
<li class="toctree-l2"><a class="reference internal" href="#visualization-of-stories">Visualization of Stories</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="patterns.html">Common Patterns</a></li>
<li class="toctree-l1"><a class="reference internal" href="plumbing.html">Plumbing - How it all fits together</a></li>
<li class="toctree-l1"><a class="reference internal" href="http.html">HTTP server</a></li>
<li class="toctree-l1"><a class="reference internal" href="connectors.html">Connecting to messaging &amp; voice platforms</a></li>
<li class="toctree-l1"><a class="reference internal" href="scheduling.html">Scheduling Reminders</a></li>
</ul>
<p class="caption"><span class="caption-text">Python API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="api/agent.html">Agent</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/events.html">Events</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/tracker.html">Dialogue State Tracker</a></li>
</ul>
<p class="caption"><span class="caption-text">Developer Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="featurisation.html">Featurization</a></li>
<li class="toctree-l1"><a class="reference internal" href="interpreters.html">Interpreters</a></li>
<li class="toctree-l1"><a class="reference internal" href="policies.html">Custom Policies</a></li>
<li class="toctree-l1"><a class="reference internal" href="state.html">Tracking Conversation State</a></li>
<li class="toctree-l1"><a class="reference internal" href="migrations.html">Migration Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Change Log</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Rasa Core</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Stories - The Training Data</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/stories.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  


    
    



    <p class="scv-banner scv-sphinx_rtd_theme"><a href="../0.8.5/stories.html"><b>Warning:</b> This document is for the development version of Rasa Core. The latest version is 0.8.5.</a></p>

<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast,
.nboutput.nblast {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast + .nbinput {
    margin-top: -19px;
}

/* nice headers on first paragraph of info/warning boxes */
.admonition .first {
    margin: -12px;
    padding: 6px 12px;
    margin-bottom: 12px;
    color: #fff;
    line-height: 1;
    display: block;
}
.admonition.warning .first {
    background: #f0b37e;
}
.admonition.note .first {
    background: #6ab0de;
}
.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}
</style>
<div class="section" id="stories-the-training-data">
<span id="stories"></span><h1>Stories - The Training Data<a class="headerlink" href="#stories-the-training-data" title="Permalink to this headline">¶</a></h1>
<p>A training data sample for the dialogue system is called a <strong>story</strong>. This
shows you how to define them and how to visualise them.</p>
<div class="section" id="format">
<h2>Format<a class="headerlink" href="#format" title="Permalink to this headline">¶</a></h2>
<p>Here&#8217;s an example from the bAbi data:</p>
<div class="highlight-md"><div class="highlight"><pre><span></span><span class="gu">##</span> story_07715946                     &lt;!-- name of the story - just for debugging --&gt;
<span class="k">*</span> greet
   <span class="k">-</span> action_ask_howcanhelp
<span class="k">*</span> inform{&quot;location&quot;: &quot;rome&quot;, &quot;price&quot;: &quot;cheap&quot;}
   <span class="k">-</span> action_on_it                     &lt;!-- user utterance, in format _intent[entities] --&gt;
   <span class="k">-</span> action_ask_cuisine
<span class="k">*</span> inform{&quot;cuisine&quot;: &quot;spanish&quot;}
   <span class="k">-</span> action_ask_numpeople             &lt;!-- action of the bot to execute --&gt;
<span class="k">*</span> inform{&quot;people&quot;: &quot;six&quot;}
   <span class="k">-</span> action_ack_dosearch
</pre></div>
</div>
<p>This is what we call a <strong>story</strong>. A story starts with a name preceded by two
hashes <code class="docutils literal"><span class="pre">##</span> <span class="pre">story_03248462</span></code>, this is arbitrary but can be used for debugging.
The end of a story is denoted by a newline, and then a new story starts again with <code class="docutils literal"><span class="pre">##</span></code>.</p>
<p>You can use <code class="docutils literal"><span class="pre">&gt;</span> <span class="pre">checkpoints</span></code> to modularize and simplify your training data:</p>
<div class="highlight-md"><div class="highlight"><pre><span></span><span class="gu">##</span> first story
<span class="k">*</span> hello
   <span class="k">-</span> action_ask_user_question
<span class="k">&gt; </span><span class="ge">check_asked_question</span>

<span class="gu">##</span> user affirms question
<span class="k">&gt; </span><span class="ge">check_asked_question</span>
<span class="k">*</span> affirm
  <span class="k">-</span> action_handle_affirmation

<span class="gu">##</span> user denies question
<span class="k">&gt; </span><span class="ge">check_asked_question</span>
<span class="k">*</span> deny
  <span class="k">-</span> action_handle_denial
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You can also <strong>spread your stories across multiple files</strong> and specify the
folder containing the files for most of the scripts (e.g. training,
visualization). The stories will be treated as if they would have
been part of one large file.</p>
</div>
</div>
<div class="section" id="visualization-of-stories">
<span id="story-visualization"></span><h2>Visualization of Stories<a class="headerlink" href="#visualization-of-stories" title="Permalink to this headline">¶</a></h2>
<p>Sometimes it is helpful to get an overview of the conversational paths that
are described within a story file. To make debugging easier and to ease
discussions about bot flows, you can visualize the content of a story file.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>For this to
work, you need to <strong>install graphviz</strong>. These are the instructions to do that
on OSX, for other systems the instructions might be slightly different:</p>
<div class="last highlight-bash"><div class="highlight"><pre><span></span>brew install graphviz
pip install pygraphviz --install-option<span class="o">=</span><span class="s2">&quot;--include-path=/usr/include/graphviz&quot;</span> <span class="se">\</span>
  --install-option<span class="o">=</span><span class="s2">&quot;--library-path=/usr/lib/graphviz/&quot;</span>
</pre></div>
</div>
</div>
<p>As soon as this is installed you can visualize stories like this:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nb">cd</span> examples/concertbot/
python -m rasa_core.visualize -d concert_domain.yml -s data/stories.md -o graph.png
</pre></div>
</div>
<p>This will run through the stories of the <code class="docutils literal"><span class="pre">concertbot</span></code> example in
<code class="docutils literal"><span class="pre">data/stories.md</span></code> and create a graph stored in the
output image <code class="docutils literal"><span class="pre">graph.png</span></code>.</p>
<img alt="_images/concert_stories.png" src="_images/concert_stories.png" />
<p>We can also run the visualisation directly from code. For this example, we can
create a <code class="docutils literal"><span class="pre">visualize.py</span></code> in <code class="docutils literal"><span class="pre">examples/concertbot</span></code> with the following code:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">absolute_import</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">division</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">print_function</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">unicode_literals</span>

<span class="kn">from</span> <span class="nn">rasa_core.agent</span> <span class="k">import</span> <span class="n">Agent</span>
<span class="kn">from</span> <span class="nn">rasa_core.policies.keras_policy</span> <span class="k">import</span> <span class="n">KerasPolicy</span>
<span class="kn">from</span> <span class="nn">rasa_core.policies.memoization</span> <span class="k">import</span> <span class="n">MemoizationPolicy</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">agent</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">(</span><span class="s2">&quot;concert_domain.yml&quot;</span><span class="p">,</span>
                  <span class="n">policies</span><span class="o">=</span><span class="p">[</span><span class="n">MemoizationPolicy</span><span class="p">(),</span> <span class="n">KerasPolicy</span><span class="p">()])</span>

    <span class="n">agent</span><span class="o">.</span><span class="n">visualize</span><span class="p">(</span><span class="s2">&quot;data/stories.md&quot;</span><span class="p">,</span>
                    <span class="n">output_file</span><span class="o">=</span><span class="s2">&quot;graph.png&quot;</span><span class="p">,</span> <span class="n">max_history</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>Which will create the same image as the above python script call. The shown
graph is still very simple, but the graphs can get quite complex.</p>
<p>If you want to replace the messages from the stories file, which usually look
like <code class="docutils literal"><span class="pre">greet</span></code> with real messages e.g. <code class="docutils literal"><span class="pre">Hello</span></code>, you can pass in a Rasa
NLU training data instance to replace them with messages from your training
data.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The story visualization needs to load your domain. If you have
any custom actions written in python make sure they are part of the python
path, and can be loaded by the visualization script using the module path
given for the action in the domain (e.g. <code class="docutils literal"><span class="pre">actions.ActionSearchVenues</span></code>).</p>
</div>
</div>
</div>


           </div>
          </div>
          <footer>

  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="patterns.html" class="btn btn-neutral float-right" title="Common Patterns" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="domains.html" class="btn btn-neutral" title="Domain, Slots, and Actions" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Rasa Technologies GmbH.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
        <span class="fa fa-book"> Other Versions</span>
        v: master
        <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
        <dl>
            <dt>Tags</dt>
            <dd><a href="../0.8.5/stories.html">0.8.5</a></dd>
            <dd><a href="../0.8.4/stories.html">0.8.4</a></dd>
            <dd><a href="../0.8.3/stories.html">0.8.3</a></dd>
            <dd><a href="../0.8.2/stories.html">0.8.2</a></dd>
            <dd><a href="../0.8.1/stories.html">0.8.1</a></dd>
            <dd><a href="../0.8.0/stories.html">0.8.0</a></dd>
            <dd><a href="../0.7.9/stories.html">0.7.9</a></dd>
            <dd><a href="../0.6.9/stories.html">0.6.9</a></dd>
        </dl>
        <dl>
            <dt>Branches</dt>
            <dd><a href="stories.html">master</a></dd>
        </dl>
    </div>
</div>


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.8.2',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>

  
  
 
<!-- Global Site Tag (gtag.js) - Google Analytics -->
<script type="text/javascript" src="//script.crazyegg.com/pages/scripts/0074/3851.js" async="async"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-87333416-1"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments)};
gtag('js', new Date());

gtag('config', 'UA-87333416-1');
</script>


</body>
</html>